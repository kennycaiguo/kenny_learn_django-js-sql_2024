{% extends 'layout.html' %}

{% block title %}
    <title>订单管理</title>
{% endblock %}

{% block content %}
    <div class="container">
        <div>
{#            <input type="button" id="btnAdd" class="btn btn-primary" value="新增订单" data-toggle="modal" data-target="#myModal">#}
            <input type="button" id="btnAdd" class="btn btn-primary" value="新增订单">

        </div>
    </div>
    <!-- Modal 新建订单模态对话框-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">新增订单</h4>
          </div>
          <div class="modal-body">
           {#     显示订单表单  ,使用Ajax请求提交实际,也不需要csrf_token     #}
              <form id="orderForm">
                  <div class="clearfix">
                 {% for item in form %}
                  <div class="col-xs-6">
                     <div class="form-group" style="position: relative;margin-bottom: 30px;">
                       {{ item.label }}
                       {{ item }}
                     <span class="error-msg" style="color: red;position: absolute;margin-top: 5px;"></span>
                     </div>
                  </div>
                 {% endfor %}
                  {#       这里原本有一个按钮用来提交数据,但这里由于使用了模态框,我们就不需要这个按钮,直接使用模态框的按钮来提交           #}
               </div>
              </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button id="btnSave" type="button" class="btn btn-primary">保存</button>
          </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block js %}
    <script>
       $(function (){
           $("#btnAdd").click(function () {
               //显示对话框
               {#$("#myModal").modal("toggle")#}
               $("#myModal").modal("show")
           })
        $("#btnSave").click(function () {
            {#alert("点击了保存按钮...")#}
             $(".error-msg").empty(); //清除上一次的错误信息.
              $.ajax({
                  //发送表单数据到后台
                  url:"/order/add/",
                  type:"post",
                  data:$("#orderForm").serialize(),
                  dataType:"JSON",
                  success:function (ret) {
                      console.log(ret)
                      if(ret.status){
                          alert("添加订单成功!")
                          //用js刷新页面,否则新增加的数据不会体现在页面上
                          location.reload()
                      } else{
                          $.each(ret.errors,function (name, data) {
                              $("#id_"+name).next().text(data[0]) //提交失败显示错误信息
                          })
                      }
                  }
              })
        })
       })
    </script>
{% endblock %}

